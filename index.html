<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blackbox AI Interface</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;500;600&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: #0b0b0b; color: #ececec; }
        .chat-gradient { background: linear-gradient(180deg, rgba(11,11,11,0) 0%, rgba(11,11,11,1) 85%); }
        .markdown-body pre { background: #161616; padding: 1.25rem; border-radius: 12px; border: 1px solid #2a2a2a; margin: 1rem 0; overflow-x: auto; }
        .markdown-body code { font-family: 'Fira Code', monospace; font-size: 0.85rem; color: #7dd3fc; }
        .sidebar-active { background-color: #1f1f1f; border-left: 4px solid #3b82f6; }
        ::-webkit-scrollbar { width: 4px; }
        ::-webkit-scrollbar-thumb { background: #333; border-radius: 10px; }
    </style>
</head>
<body class="h-screen flex overflow-hidden">

    <aside id="sidebar" class="w-72 flex-shrink-0 bg-[#121212] flex flex-col border-r border-[#222] transition-all duration-300">
        <div class="p-5">
            <button onclick="createNewChat()" class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-blue-600 hover:bg-blue-700 text-white rounded-xl transition font-semibold shadow-lg shadow-blue-900/20">
                <i data-lucide="plus-circle" class="w-5 h-5"></i> New Session
            </button>
        </div>
        <div id="history-list" class="flex-1 overflow-y-auto px-3 space-y-1"></div>
        <div class="p-4 border-t border-[#222]">
            <button onclick="toggleModal('settings-modal')" class="w-full flex items-center gap-3 px-4 py-2 hover:bg-[#1f1f1f] rounded-lg transition text-sm text-gray-400">
                <i data-lucide="sliders-horizontal" class="w-4 h-4"></i> API Config
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col relative min-w-0">
        <header class="h-16 flex items-center justify-between px-6 border-b border-[#222] bg-[#0b0b0b]/80 backdrop-blur-md z-10">
            <div class="flex items-center gap-4">
                <button onclick="toggleSidebar()" class="p-2 hover:bg-white/5 rounded-lg"><i data-lucide="menu"></i></button>
                <div class="flex flex-col">
                    <span class="text-xs font-bold text-blue-500 uppercase tracking-widest">Blackbox AI</span>
                    <span id="current-model-label" class="text-[10px] text-gray-500 font-mono">Loading...</span>
                </div>
            </div>
        </header>

        <div id="viewport" class="flex-1 overflow-y-auto pb-40 pt-10">
            <div id="welcome" class="max-w-2xl mx-auto text-center py-20 space-y-6">
                <h1 class="text-5xl font-extrabold tracking-tight text-white">How can I help?</h1>
                <p class="text-gray-500 text-lg">Harnessing Blackbox AI for code and chat.</p>
                <div class="flex flex-wrap justify-center gap-3">
                    <button onclick="quickPrompt('Write a Python function to sort a list')" class="px-4 py-2 bg-[#1a1a1a] border border-[#333] rounded-full text-sm hover:border-blue-500 transition">Python Sorting</button>
                    <button onclick="quickPrompt('Explain the concept of WebSockets')" class="px-4 py-2 bg-[#1a1a1a] border border-[#333] rounded-full text-sm hover:border-blue-500 transition">WebSockets</button>
                </div>
            </div>
            <div id="chat-container" class="max-w-3xl mx-auto px-4 space-y-12"></div>
        </div>

        <div class="absolute bottom-0 w-full chat-gradient pb-8 pt-10">
            <div class="max-w-3xl mx-auto px-4 relative">
                <div class="relative bg-[#1a1a1a] border border-[#333] rounded-2xl p-2 shadow-2xl focus-within:border-blue-500/50 transition-all">
                    <textarea id="user-input" rows="1" placeholder="Ask anything..." class="w-full bg-transparent border-none py-3 px-4 focus:ring-0 resize-none text-base outline-none pr-16"></textarea>
                    <button id="send-btn" class="absolute right-3 bottom-3 p-2.5 bg-blue-600 text-white rounded-xl hover:bg-blue-500 transition-all disabled:opacity-20 shadow-lg shadow-blue-600/20">
                        <i data-lucide="send-horizontal" class="w-5 h-5"></i>
                    </button>
                </div>
                <p class="text-[10px] text-center text-gray-600 mt-3 uppercase tracking-widest">Powered by Blackbox AI Engine</p>
            </div>
        </div>
    </main>

    <div id="settings-modal" class="fixed inset-0 bg-black/90 hidden flex items-center justify-center z-50 p-4">
        <div class="bg-[#161616] w-full max-w-md p-8 rounded-3xl border border-[#333]">
            <h2 class="text-xl font-bold mb-6">Configuration</h2>
            <div class="space-y-4">
                <div>
                    <label class="block text-[10px] font-bold text-gray-500 mb-2 uppercase">Preferred Model</label>
                    <select id="model-select" class="w-full bg-[#0b0b0b] border border-[#333] rounded-xl p-3 outline-none focus:border-blue-500 text-sm">
                        <option value="blackbox">Blackbox Default</option>
                        <option value="gpt-4o">GPT-4o</option>
                        <option value="gemini-pro">Gemini Pro</option>
                        <option value="claude-3-5-sonnet">Claude 3.5 Sonnet</option>
                    </select>
                </div>
                <p class="text-xs text-gray-500 italic">Note: Blackbox API typically allows direct browser requests. No API key is required for basic usage in this implementation.</p>
            </div>
            <button onclick="saveSettings()" class="w-full mt-8 py-4 bg-blue-600 text-white rounded-xl font-bold hover:bg-blue-500 transition">Save & Apply</button>
            <button onclick="toggleModal('settings-modal')" class="w-full mt-2 py-2 text-gray-500 text-sm">Cancel</button>
        </div>
    </div>

    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>

    <script>
        let chats = JSON.parse(localStorage.getItem('bb_chats') || '[]');
        let currentChatId = null;
        let config = JSON.parse(localStorage.getItem('bb_config') || '{"model": "blackbox"}');

        document.addEventListener('DOMContentLoaded', () => {
            lucide.createIcons();
            loadConfig();
            renderHistory();
            document.getElementById('send-btn').addEventListener('click', handleSend);
            document.getElementById('user-input').addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });
        });

        function loadConfig() {
            document.getElementById('model-select').value = config.model;
            document.getElementById('current-model-label').innerText = config.model;
        }

        function saveSettings() {
            config.model = document.getElementById('model-select').value;
            localStorage.setItem('bb_config', JSON.stringify(config));
            loadConfig();
            toggleModal('settings-modal');
        }

        function toggleModal(id) { document.getElementById(id).classList.toggle('hidden'); }
        function toggleSidebar() { document.getElementById('sidebar').classList.toggle('-ml-72'); }

        async function handleSend() {
            const input = document.getElementById('user-input');
            const btn = document.getElementById('send-btn');
            const text = input.value.trim();
            if (!text) return;

            if (!currentChatId) {
                currentChatId = Date.now();
                chats.unshift({ id: currentChatId, title: text.substring(0, 30), messages: [] });
            }

            const chat = chats.find(c => c.id === currentChatId);
            chat.messages.push({ role: 'user', content: text });
            
            input.value = '';
            input.style.height = 'auto';
            document.getElementById('welcome').classList.add('hidden');
            appendUI('user', text);

            const aiId = 'ai-' + Date.now();
            const aiBody = appendUI('assistant', '<span class="animate-pulse">Thinking...</span>', aiId);
            btn.disabled = true;

            try {
                // Blackbox API Call
                const response = await fetch("https://www.blackbox.ai/api/chat", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({
                        messages: chat.messages,
                        id: aiId,
                        previewToken: null,
                        userId: null,
                        codeModelMode: true,
                        agentMode: {},
                        trendingAgentMode: {},
                        isAdvancedMode: false,
                        maxTokens: 1024,
                        isChromeExt: false,
                        githubToken: null,
                        clickedAnswer2: false,
                        clickedAnswer3: false,
                        visitFromDelta: false,
                        mobileClient: false,
                        model: config.model
                    })
                });

                const result = await response.text();
                // Clean up any metadata Blackbox adds to the string
                const cleanResult = result.replace(/\$@\$.*?\$@\$/g, '').trim();
                
                aiBody.innerHTML = marked.parse(cleanResult);
                aiBody.querySelectorAll('pre code').forEach(el => hljs.highlightElement(el));
                
                chat.messages.push({ role: 'assistant', content: cleanResult });
                localStorage.setItem('bb_chats', JSON.stringify(chats));
            } catch (err) {
                aiBody.innerHTML = `<p class="text-red-400">Error: ${err.message}. Check your internet connection.</p>`;
            } finally {
                btn.disabled = false;
                renderHistory();
                scrollToBottom();
            }
        }

        function appendUI(role, content, id) {
            const container = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.className = `flex gap-5 ${role === 'user' ? 'justify-end' : 'justify-start'}`;
            div.innerHTML = `
                <div class="flex flex-col ${role === 'user' ? 'items-end' : 'w-full'}">
                    <div class="flex items-center gap-2 mb-2 px-1">
                        <span class="text-[9px] font-bold uppercase tracking-widest text-gray-500">${role}</span>
                    </div>
                    <div id="${id || ''}" class="${role === 'user' ? 'bg-blue-600 text-white px-5 py-3 rounded-2xl max-w-[85%] shadow-lg' : 'w-full text-gray-200'} prose prose-invert">
                        ${role === 'user' ? content : marked.parse(content)}
                    </div>
                </div>
            `;
            container.appendChild(div);
            if (role === 'assistant') div.querySelectorAll('pre code').forEach(el => hljs.highlightElement(el));
            scrollToBottom();
            return id ? document.getElementById(id) : div;
        }

        function renderHistory() {
            const list = document.getElementById('history-list');
            list.innerHTML = chats.map(c => `
                <button onclick="switchChat(${c.id})" class="w-full text-left px-4 py-3 rounded-xl text-sm truncate transition ${currentChatId === c.id ? 'sidebar-active text-white' : 'text-gray-500 hover:bg-[#1a1a1a]'}">
                    ${c.title}
                </button>
            `).join('');
        }

        function switchChat(id) {
            currentChatId = id;
            const chat = chats.find(c => c.id === id);
            document.getElementById('chat-container').innerHTML = '';
            document.getElementById('welcome').classList.add('hidden');
            chat.messages.forEach(m => appendUI(m.role, m.content));
            renderHistory();
        }

        function quickPrompt(t) { document.getElementById('user-input').value = t; handleSend(); }
        function scrollToBottom() { const v = document.getElementById('viewport'); v.scrollTo({top: v.scrollHeight, behavior: 'smooth'}); }
        function createNewChat() { location.reload(); }
    </script>
</body>
</html>
